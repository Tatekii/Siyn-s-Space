# 构建阶段
## 打包时间
- 缩小loader的作用范围`include`,`exclude`
```javascript

module.exports = {
	//...
	resolve: {
	modules: [path.resolve(__dirname, 'src'), 'node_modules'], // 搜索位置
	extensions:[".js",".jsx"] // 搜索的后缀名,虽然写的时候可以省略,但会增加搜索的性能损耗
	}
};
```
- 打包缓存
## 打包大小
- 资源压缩
	css/js/图片压缩
- 代码分包
- CDN
	- 动态替换`html-webpack-plugin`
- babel转译优化
	babel会在在每个需要编译的地方都加上helper函数，造成冗余，使用`"@babel/plugin-transform-runtime"`
- 按需打包组件
- `tree shaking`
- `gzip`压缩

# 加载阶段
1. 资源标签顺序
	1. CSS阻止RENDER TREE生成
	2. JS阻止DOM TREE生成`async`,`defer`
		![[Pasted image 20250303105843.png]]
	3. 
2. 骨架屏
3. 路由懒加载/异步组件
4. 图片
	1.  js脚本控制src赋值懒加载
	2. `<img src="image.jpg" alt="..." loading="lazy" />`
	3. 图片占位符
5. 预加载`preload`属性
6. 预解析`prefetch`属性

# 运行阶段
1. 长列表
	1. 虚拟列表
	2. 后端分页
2. 浏览器缓存
3. DOM性能
	1. 避免[[页面渲染流程#**回流（Reflow）**|重排]]
	2. 读取元素的位置大小属性（如`scrollTop`,`offsetHeight`...）
4. JAVASCRIPT性能
5. CSS性能
6. 使用`Worker`
7. 计时器相关
	1. `requestAnimationFrame`下次重绘前
	2. [[ConcurrrentMode#时间切片#`performance`|performance.now()]]


# 【运行阶段】

## JS

- 合理使用浏览器缓存策略

- 不频繁操作DOM，使用虚拟DOM或`fragment`批量操作

- 读取元素的位置大小属性（如`scrollTop`,`offsetHeight`...）浏览器会立即重排，更不能将这些属性放入循环中

- 使用事件委托

- 使用`Web Worker`

- 使用`requestAnimationFrame`代替有高性能需求的计时器

## CSS

- 避免`css`选择器嵌套过深

- 避免大量使用`id`选择器，每个`id`都会变为一个单独的全局变量

- 避免使用`table`，`table`会频繁触发重排

- 更换`class`代替直接修改`style`

- 合理使用GPU加速

- `css3`动画`transform`代替修改几何信息`left,top...`

- `opacity`代替`visibility`

- 复杂动画元素脱离文档流`position:absolute/fixed`

- 加上`will-change`属性的元素会交给合成层渲染（GPU

  
  
  

# 【资源优化】

## 图片资源

### 高效图片格式

- [WebP](https://en.wikipedia.org/wiki/WebP)

- 矢量图[SVG](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics)

- Base64位图 [base64](https://en.wikipedia.org/wiki/Base64)

### 响应式图片

```javascript

<picture>

<source srcset="banner_w1000.jpg" media="(min-width: 801px)">

<source srcset="banner_w800.jpg" media="(max-width: 800px)">

<img src="banner_w800.jpg" alt="">

</picture>

```

### 图片压缩

- [tinypng](https://tinypng.com/)

- [webpack插件](https://webpack.docschina.org/plugins/image-minimizer-webpack-plugin/#root)

  

### 小图合并

- 合并雪碧图

- 使用`icon-font`字体图标

```javascript

svg-sprite-loader

```

  
  

# 性能检测报告

- `Performance`

- `Lighthouse`

  

## 关键时间点

- `FCP`页面上呈现第一DOM元素的时间，之前都是白屏

- `TTI`页面可以交互的时间

- `LCP`视口内最大面积内容渲染时间

  

```javascript

const timing = window.performance && window.performance.timing

const navigation = window.performance && window.performance.navigation

  

// DNS

const DNS = timing.domainLookupEnd - timing.domainLookupStart

  

// Network

const NetWork = timing.responseEnd - timing.navigationStart

  

// 渲染

const Processing = (timing.domComplete || timing.domLoading) - timing.domLoading

  

// 可交互

const Active = timing.domInteractive = timing.navigationStart

  

```