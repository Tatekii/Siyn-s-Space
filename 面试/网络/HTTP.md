# HTTPï¼ˆHyperText Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®

HTTP æ˜¯åŸºäº TCP/IP åè®®çš„åº”ç”¨å±‚åè®®ï¼Œç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡

## HTTP æŠ¥æ–‡ç»„æˆéƒ¨åˆ†

  - è¯·æ±‚æŠ¥æ–‡
	- è¯·æ±‚è¡Œ `Request Method`,`Request URL`
	- è¯·æ±‚å¤´ åŒ…å«è‹¥å¹²å±æ€§ï¼Œkey:value å€¼	
	- ç©ºè¡Œ
	- è¯·æ±‚ä½“
- å“åº”æŠ¥æ–‡
	- çŠ¶æ€è¡Œ `Request Version`,`Status Code`
	- å“åº”å¤´ åŒ…å«è‹¥å¹²å±æ€§ï¼Œkey:value å€¼
	- ç©ºè¡Œ
	- å“åº”ä½“

### å­—æ®µ
- content
	- `Content-Encoding`
	- `Content-Type`
	- `Content-Length`
	- `Content-Language`
- è¯·æ±‚æ¥æº
	- `Connection`:keep-alive / close / upgrade
	- `Referer`è¯·æ±‚æ¥æºåŸŸ ä¿ç•™å®Œæ•´URL
	- `Origin`è¯·æ±‚æ¥æºåŸŸ ä»…ä¿ç•™åè®®åŸŸåç«¯å£
	- `Host`æœåŠ¡å™¨åŸŸå
	- `Upgrade`:websocket
- ç¼“å­˜ç›¸å…³
	- `Cache-Control`
	- `Pragma`
	- `Expires`å®ä½“é¦–éƒ¨
	- `Last-Modified`å®ä½“é¦–éƒ¨
	- `If-Modified-Since`
	- `ETag`
	- `If-None-Match`
- Cookie ç›¸å…³
	- `Cookie`
	- `Set-Cookie`
- è·¨åŸŸç›¸å…³
	- `Origin`
	- `Access-Control-Request-Method`
	- `Access-Control-Allow-Origin`
	- `Access-Control-Allow-Methods`
	- `Access-Control-Max-Age`
	- `Access-Control-Allow-Credentials`

## HTTP çš„å“åº”çŠ¶æ€ç 

> æ¶ˆæ¯

- 100 ç»§ç»­å‘é€

- 101 åè®®å‡çº§

> è¯·æ±‚æˆåŠŸ

- 200 OK

- 206 å¤„ç†äº†éƒ¨åˆ†è¯·æ±‚

> é‡å®šå‘

- 301 æ°¸ä¹…æ€§é‡å®šå‘ï¼Œèµ„æºå·²ç»åˆ†é…äº†æ–°çš„ URl

- 302 ä¸´æ—¶é‡å®šå‘

- 303 è¡¨ç¤ºèµ„æºå­˜åœ¨ç€å¦ä¸€ä¸ª URLï¼Œåº”ä½¿ç”¨ GET æ–¹æ³•è·å–èµ„æº

> å¯¹äº 301/302/303 å“åº”ï¼Œå‡ ä¹æ‰€æœ‰æµè§ˆå™¨éƒ½ä¼šåˆ é™¤æŠ¥æ–‡ä¸»ä½“å¹¶è‡ªåŠ¨ç”¨ GET é‡æ–°è¯·æ±‚

- 304 èµ„æºæœªä¿®æ”¹

> è¯·æ±‚é”™è¯¯

- 400 Bad Request è¯·æ±‚æŠ¥æ–‡è¯­æ³•é”™è¯¯

- 401 Unauthorized éœ€è¦è®¤è¯

- 403 Forbidden ç¦æ­¢è®¿é—®

- 404 Not Found

- 405 è¯·æ±‚æ–¹æ³•éæ³•

- 408 è¯·æ±‚è¶…æ—¶

> æœåŠ¡å™¨é”™è¯¯

- 500 æœåŠ¡å™¨é”™è¯¯

- 503 æœåŠ¡å™¨è¿‡è½½

- 505 ä¸æ”¯æŒè¯¥ç‰ˆæœ¬ HTTP åè®®

## HTTP å‘å±•å†ç¨‹
### HTTP 0.9

- æ²¡æœ‰å¤´éƒ¨ï¼ˆboth in è¯·æ±‚å’Œå“åº”ï¼‰
- åªèƒ½ä¸”ç›´æ¥è¿”å› html
- æ²¡æœ‰çŠ¶æ€ç 
#### è¯·æ±‚æ–¹æ³•
- `GET`
### HTTP1.0

- åŠ å…¥äº†è¯·æ±‚å¤´å’Œå“åº”å¤´
- æ”¯æŒå¤šåª’ä½“ç±»å‹æ•°æ®`Content-Type`
- åŠ å…¥çŠ¶æ€ç 

#### è¯·æ±‚æ–¹æ³•
- `GET`
	1. è¯·æ±‚æ”¾åœ¨å‚æ•°æ”¾åœ¨ URL åœ°å€å
	2. åˆ·æ–°æ— å‰¯ä½œç”¨
	3. èƒ½ä¿å­˜ä¹¦ç­¾ï¼Œä¼šè¢«æµè§ˆå™¨ç¼“å­˜ï¼ŒåŠ å…¥å†å²è®°å½•
	4. ç¼–ç  urlencoded
	5. æµè§ˆå™¨æˆ–è€…æœåŠ¡å™¨ä¼šå¯¹ URL é•¿åº¦åšé™åˆ¶
- `POST`
	1. è¯·æ±‚å‚æ•°æ”¾åœ¨ body ä¸­
	2. åˆ·æ–°æç¤ºå†æ¬¡æäº¤ï¼Ÿ
	3. ä¸ç¼“å­˜ä¸ä¿å­˜ä¸è®°å½•
	4. æ•°æ®ç±»å‹æ— é™åˆ¶
- `HEAD` 
	1. åªè¯·æ±‚å¤´éƒ¨ï¼Œè·å–å…¶ä¸­â€œå…³äºè¯¥èµ„æºçš„ä¿¡æ¯â€(å…ƒä¿¡æ¯æˆ–ç§°å…ƒæ•°æ®)
#### çŸ­è¿æ¥
æ¯æ¬¡é€šä¿¡å®Œåæ–­å¼€ TCP é€šé“ï¼Œæ¯ä¸ªæ–°è¯·æ±‚éƒ½éœ€è¦å»ºç«‹æ–°çš„è¿æ¥ã€‚
é˜Ÿå¤´é˜»å¡ (Head-of-Line Blocking, HOLB)ï¼š å³ä½¿å¤šä¸ªè¯·æ±‚å¯ä»¥å¹¶è¡Œå¤„ç†ï¼Œä¹Ÿéœ€è¦æ’é˜Ÿç­‰å¾… TCP è¿æ¥çš„å»ºç«‹å’Œå…³é—­ã€‚
ğŸ˜­å­˜åœ¨é˜Ÿå¤´é˜»å¡(Head-of-Line Blocking, HOLB)
### HTTP1.1

- å¼•å…¥äº†æ›´ç»†è‡´çš„ç¼“å­˜æ§åˆ¶å¦‚ `Cache-Control`ã€`ETag` ç­‰ã€‚
- èŒƒå›´è¯·æ±‚ï¼ˆByte-Range Requestsï¼‰ï¼šå…è®¸å®¢æˆ·ç«¯è¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†ï¼ˆä¾‹å¦‚ï¼Œæ–­ç‚¹ç»­ä¼ ï¼‰ã€‚
#### æŒä¹…è¿æ¥
ä¹Ÿç§°ä¸º **HTTP Keep-Alive**ï¼Œæ˜¯æŒ‡åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸Šå¯ä»¥å‘é€å’Œæ¥æ”¶**å¤šä¸ª HTTP è¯·æ±‚å’Œå“åº”**ï¼Œè€Œä¸éœ€è¦ä¸ºæ¯ä¸ªè¯·æ±‚éƒ½å»ºç«‹å’Œå…³é—­æ–°çš„ TCP è¿æ¥ã€‚
è¿æ¥ä¼šåœ¨ä¸€æ®µæ—¶é—´ä¸æ´»åŠ¨åï¼ˆç”± `Keep-Alive` è¶…æ—¶æ—¶é—´æ§åˆ¶ï¼‰æˆ–åœ¨ä»»ä¸€æ–¹æ˜ç¡®å…³é—­æ—¶æ‰æ–­å¼€ã€‚
ğŸ˜­å­˜åœ¨é˜Ÿå¤´é˜»å¡(Head-of-Line Blocking, HOLB)
```js
// headers
Connection: keep-alive
Keep-Alive: timeout=5, max=100
```

#### ç®¡çº¿åŒ–
**ç®¡çº¿åŒ–**æ˜¯å»ºç«‹åœ¨æŒä¹…è¿æ¥ä¹‹ä¸Šçš„ä¼˜åŒ–ã€‚å®ƒå…è®¸å®¢æˆ·ç«¯åœ¨**æ”¶åˆ°ä¸Šä¸€ä¸ªè¯·æ±‚çš„å“åº”ä¹‹å‰ï¼Œå°±å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚**ã€‚å®¢æˆ·ç«¯å¯ä»¥ä¸€æ¬¡æ€§å‘é€å¤šä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œç„¶åæœåŠ¡å™¨æŒ‰ç…§è¯·æ±‚çš„é¡ºåºä¾æ¬¡è¿”å›å“åº”ã€‚
åªèƒ½ç”¨äº`GET`,`HEAD`,`PUT`,`DELETE`è¯·æ±‚ã€‚

##### **å±€é™æ€§ï¼ˆä¸ºä»€ä¹ˆç®¡çº¿åŒ–åœ¨å®è·µä¸­å¾ˆå°‘è¢«å¹¿æ³›ä½¿ç”¨ï¼‰ï¼š**

å°½ç®¡ç®¡çº¿åŒ–çœ‹èµ·æ¥å¾ˆæœ‰å‰æ™¯ï¼Œä½†å®ƒåœ¨å®è·µä¸­å¹¶æœªè¢«å¹¿æ³›éƒ¨ç½²ï¼ŒåŸå› å¦‚ä¸‹ï¼š

- **æœåŠ¡å™¨å¿…é¡»æŒ‰åºå“åº”ï¼š** æœåŠ¡å™¨å¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¯·æ±‚çš„é¡ºåºå‘é€å“åº”ã€‚å¦‚æœè¯·æ±‚ A éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å¤„ç†ï¼Œé‚£ä¹ˆå³ä½¿è¯·æ±‚ B å’Œ C å·²ç»å¤„ç†å®Œæ¯•ï¼Œå®ƒä»¬ä¹Ÿå¿…é¡»ç­‰å¾… A çš„å“åº”å‘é€å‡ºå»åæ‰èƒ½å‘é€ã€‚è¿™ä»ç„¶ä¼šé€ æˆ**æœåŠ¡å™¨ç«¯çš„é˜Ÿå¤´é˜»å¡**ï¼ŒæŠµæ¶ˆäº†å¹¶è¡Œå‘é€è¯·æ±‚å¸¦æ¥çš„å¥½å¤„ã€‚
- **ç½‘ç»œä¸­é—´è®¾å¤‡æ”¯æŒé—®é¢˜ï¼š** è®¸å¤šæ—§çš„ä»£ç†æœåŠ¡å™¨ã€è´Ÿè½½å‡è¡¡å™¨å’Œé˜²ç«å¢™å¯èƒ½ä¸æ”¯æŒ HTTP ç®¡çº¿åŒ–ï¼Œæˆ–è€…åœ¨å¤„ç†ç®¡çº¿åŒ–è¯·æ±‚æ—¶è¡Œä¸ºå¼‚å¸¸ï¼Œå¯¼è‡´ä¸ç¨³å®šçš„è¿æ¥æˆ–é”™è¯¯ã€‚
- **å®¢æˆ·ç«¯å®ç°å¤æ‚æ€§ï¼š** æµè§ˆå™¨åœ¨å®ç°ç®¡çº¿åŒ–æ—¶ï¼Œéœ€è¦å¤„ç†å„ç§å¤æ‚çš„è¾¹ç¼˜æƒ…å†µï¼Œå¦‚è¯·æ±‚å¤±è´¥ã€å“åº”é¡ºåºæ··ä¹±ç­‰ï¼Œå¢åŠ äº†å®ç°çš„å¤æ‚æ€§ã€‚
- **å¹‚ç­‰æ€§é—®é¢˜ï¼š** å¦‚æœç®¡çº¿åŒ–å‘é€çš„è¯·æ±‚æ˜¯éå¹‚ç­‰çš„ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ª `POST` è¯·æ±‚ï¼‰ï¼Œå¹¶ä¸”è¿æ¥åœ¨å‘é€è¯·æ±‚åã€æ”¶åˆ°å“åº”å‰æ–­å¼€ï¼Œå®¢æˆ·ç«¯å¯èƒ½æ— æ³•ç¡®å®šæœåŠ¡å™¨æ˜¯å¦å·²ç»å¤„ç†äº†è¯¥è¯·æ±‚ã€‚å¦‚æœç®€å•åœ°é‡è¯•æ‰€æœ‰è¯·æ±‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´é‡å¤æ“ä½œã€‚
- **HTTP/2 çš„å‡ºç°ï¼š** `HTTP/2` æä¾›äº†æ›´å¼ºå¤§ã€æ›´å½»åº•çš„è§£å†³æ–¹æ¡ˆâ€”â€”**å¤šè·¯å¤ç”¨ï¼ˆMultiplexingï¼‰**ã€‚åœ¨ `HTTP/2` ä¸­ï¼Œå¤šä¸ªè¯·æ±‚å’Œå“åº”å¯ä»¥åœ¨åŒä¸€ä¸ª TCP è¿æ¥ä¸Š**å®Œå…¨å¹¶è¡Œä¸”ä¹±åº**åœ°ä¼ è¾“ï¼Œå½»åº•è§£å†³äº†é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œä½¿å¾—ç®¡çº¿åŒ–å˜å¾—ä¸å¿…è¦ã€‚

#### è¯·æ±‚æ–¹æ³•
- `OPTIONS`è¯¢é—®è·å–å½“å‰èµ„æºæ‰€æ”¯æŒçš„æ–¹æ³•
- `PUT`ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€æ–°æ–‡ä»¶
- `PATCH`æ˜¯å¯¹ PUT æ–¹æ³•çš„è¡¥å……ï¼Œç”¨æ¥å¯¹å·²çŸ¥èµ„æºè¿›è¡Œå±€éƒ¨æ›´æ–° ã€‚
- `DELETE`è¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šæ–‡ä»¶
- `TRACE`å›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ã€‚
- `CONNECT` HTTP/1.1 åè®®ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚
### SPDY
2009 å¹´æ¨å‡ºï¼Œè¯•éªŒæ€§ã€‚
ä½äº HTTP ä¸ SSl ä¹‹é—´ï¼Œæ˜¯å¯¹ HTTP çš„å¢å¼ºã€‚
1. å¤šè·¯å¤ç”¨ï¼šé€šè¿‡ä¸€ä¸ª TCP è¿æ¥ï¼Œå¯ä»¥æ— é™åˆ¶å¤„ç†å¤šä¸ª HTTP è¯·æ±‚ã€‚
2. èµ‹äºˆè¯·æ±‚ä¼˜å…ˆçº§ï¼šç»™è¯·æ±‚é€ä¸ªåˆ†é…ä¼˜å…ˆçº§é¡ºåºã€‚å¯ä»¥è§£å†³åœ¨å‘é€å¤šä¸ªè¯·æ±‚æ—¶ï¼Œå› å¸¦å®½ä½è€Œå¯¼è‡´å“åº”å˜æ…¢çš„é—®é¢˜ã€‚
3. å‹ç¼© HTTP å¤´éƒ¨ï¼šå‹ç¼©æ–¹å¼ï¼šDELEFT
4. æœåŠ¡ç«¯æ¨é€
5. SPDY ä½äº HTTP ä¸‹ï¼ŒTCP å’Œ SSL ä¹‹ä¸Šï¼Œå¯ä»¥å…¼å®¹è€ç‰ˆæœ¬ http åŒæ—¶ä½¿ç”¨å¯ç”¨çš„ ssl åŠŸèƒ½
6. SPDY å¼ºåˆ¶ä½¿ç”¨ SSL
### HTTP2
2015 å¹´å‘å¸ƒï¼ŒåŸºäº SPDY åè®®
http/1.x æ˜¯ä¸€ä¸ªè¶…æ–‡æœ¬åè®®ï¼Œè€Œ http2 æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶åè®®ã€‚
1. äºŒè¿›åˆ¶åˆ†å¸§
	å½“å®¢æˆ·ç«¯åŒæ—¶å‘æœåŠ¡ç«¯å‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆè¿™äº›è¯·æ±‚ä¼šè¢«åˆ†è§£æˆä¸€ä¸€ä¸ªçš„å¸§ï¼Œæ¯ä¸ªå¸§éƒ½ä¼šåœ¨ä¸€ä¸ª TCP é“¾è·¯ä¸­æ— åºçš„ä¼ è¾“ï¼Œå½“å¸§åˆ°è¾¾æœåŠ¡ç«¯ä¹‹åï¼Œå°±å¯ä»¥æ ¹æ® `Stream Identifier` æ¥é‡æ–°ç»„åˆå¾—åˆ°å®Œæ•´çš„è¯·æ±‚ã€‚
2. å¤´éƒ¨å‹ç¼©ï¼ˆè¯·æ±‚å’Œå“åº”é¦–éƒ¨å‹ç¼©ï¼‰
	`HPACK` ç®—æ³•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹å­—å…¸ï¼ˆé¦–éƒ¨è¡¨ï¼‰é‡å¤å¤´éƒ¨ä¸ç”¨å†å‘é€
3. æœåŠ¡ç«¯æ¨é€`Server Push`
	æœåŠ¡ç«¯èƒ½ä¸»åŠ¨è¿”å›å¤šçš„è§‰å¾—å®¢æˆ·ç«¯ä¼šç”¨åˆ°çš„èµ„æº
4. å¤šè·¯å¤ç”¨
	- åŒåŸŸåçš„é€šä¿¡éƒ½åœ¨å•ä¸ªè¿æ¥ä¸Šå®Œæˆ(åªå ç”¨ä¸€ä¸ª tcp è¿æ¥
	- å•è¿æ¥å¯ä»¥æ‰¿å—ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµ
	- æœåŠ¡ç«¯å¯æŒ‰ç…§è‡ªå®šä¹‰ä¼˜å…ˆçº§è¿”å›èµ„æº
### HTTP3
- http3 ä½¿ç”¨æ–°çš„ UDP åè®®`QUIC`ä»£æ›¿ TCP

- è§£å†³ http2 æ—¶ä»£ä¸¢åŒ…é˜»å¡

- åˆ‡æ¢ç½‘ç»œæ—¶çš„è¿æ¥ä¿æŒï¼ˆå¿«é€Ÿé‡å¯ä¼šè¯ï¼‰

- åŠ å¯†ä¼ è¾“

### è½®è¯¢
#### è½®è¯¢
- å®šæ—¶è¯·æ±‚æœåŠ¡ç«¯
#### é•¿è½®è¯¢
- è¯·æ±‚å‘å‡ºåï¼ŒæœåŠ¡å™¨**æŒ‚èµ·**ç›´åˆ°æœ‰æ•°æ®æˆ–è¶…æ—¶
- æ¯”è½®è¯¢èŠ‚çœèµ„æº
```js
function longPoll() {
  fetch('/api/messages')
    .then(res => res.json())
    .then(data => {
      render(data);
      longPoll(); // å†æ¬¡è¯·æ±‚
    });
}
longPoll();
```
